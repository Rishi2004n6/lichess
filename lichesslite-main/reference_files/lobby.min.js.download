var qo=Object.create;var At=Object.defineProperty;var Jo=Object.getOwnPropertyDescriptor;var Xo=Object.getOwnPropertyNames;var Zo=Object.getPrototypeOf,Yo=Object.prototype.hasOwnProperty;var Qo=(e,t)=>()=>(e&&(t=e(e=0)),t);var er=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var tr=(e,t,o,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of Xo(t))!Yo.call(e,n)&&n!==o&&At(e,n,{get:()=>t[n],enumerable:!(r=Jo(t,n))||r.enumerable});return e};var or=(e,t,o)=>(o=e!=null?qo(Zo(e)):{},tr(t||!e||!e.__esModule?At(o,"default",{value:e,enumerable:!0}):o,e));var s=Qo(()=>{});var ro=er((ca,oo)=>{"use strict";s();oo.exports=function(t){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=void 0,a=void 0,l=void 0,m=[];return function(){var y=jr(o),w=new Date().getTime(),S=!n||w-n>y;n=w;for(var P=arguments.length,c=Array(P),u=0;u<P;u++)c[u]=arguments[u];if(S&&r.leading)return r.accumulate?Promise.resolve(t.call(this,[c])).then(function(f){return f[0]}):Promise.resolve(t.call.apply(t,[this].concat(c)));if(a?clearTimeout(l):a=Gr(),m.push(c),l=setTimeout(h.bind(this),y),r.accumulate){var g=m.length-1;return a.promise.then(function(f){return f[g]})}return a.promise};function h(){var p=a;clearTimeout(l),Promise.resolve(r.accumulate?t.call(this,m):t.apply(this,m[m.length-1])).then(p.resolve,p.reject),m=[],a=null}};function jr(e){return typeof e=="function"?e():e}function Gr(){var e={};return e.promise=new Promise(function(t,o){e.resolve=t,e.reject=o}),e}});s();s();s();var q=e=>e!==void 0;var oe=(e,t)=>{let o=e;return r=>(q(r)&&(o=r,t(r)),o)};var re=e=>{let t;return()=>(t===void 0&&(t=e()),t)};var rr={Accept:"application/vnd.lichess.v5+json"},Ht={cache:"no-cache",credentials:"same-origin"},It={"X-Requested-With":"XMLHttpRequest"},Vt=e=>{if(e.ok)return e;throw e.status==429?new Error("Too many requests"):e.status==413?new Error("The uploaded file is too large"):new Error(`Error ${e.status}`)};var ne=(e,t={})=>nr(e,t).then(o=>Vt(o).json()),nr=(e,t={})=>fetch(e,{...Ht,headers:{...rr,...It},...t}),I=(e,t={})=>et(e,t).then(o=>Vt(o).text()),et=(e,t={})=>fetch(e,{...Ht,headers:{...It},...t});var O=e=>{let t=new FormData;for(let o of Object.keys(e))q(e[o])&&t.append(o,e[o]);return t},ie=(e,t)=>{let o=new URLSearchParams;for(let n of Object.keys(t))q(t[n])&&o.append(n,t[n]);let r=o.toString();return r?`${e}?${r}`:e};s();s();s();s();s();function ir(e,t){return document.createElement(e,t)}function sr(e,t,o){return document.createElementNS(e,t,o)}function ar(){return G(document.createDocumentFragment())}function lr(e){return document.createTextNode(e)}function cr(e){return document.createComment(e)}function dr(e,t,o){if(j(e)){let r=e;for(;r&&j(r);)r=G(r).parent;e=r!=null?r:e}j(t)&&(t=G(t,e)),o&&j(o)&&(o=G(o).firstChildNode),e.insertBefore(t,o)}function mr(e,t){e.removeChild(t)}function pr(e,t){j(t)&&(t=G(t,e)),e.appendChild(t)}function Ft(e){if(j(e)){for(;e&&j(e);)e=G(e).parent;return e!=null?e:null}return e.parentNode}function ur(e){var t;if(j(e)){let o=G(e),r=Ft(o);if(r&&o.lastChildNode){let n=Array.from(r.childNodes),a=n.indexOf(o.lastChildNode);return(t=n[a+1])!==null&&t!==void 0?t:null}return null}return e.nextSibling}function hr(e){return e.tagName}function fr(e,t){e.textContent=t}function gr(e){return e.textContent}function br(e){return e.nodeType===1}function yr(e){return e.nodeType===3}function vr(e){return e.nodeType===8}function j(e){return e.nodeType===11}function G(e,t){var o,r,n;let a=e;return(o=a.parent)!==null&&o!==void 0||(a.parent=t!=null?t:null),(r=a.firstChildNode)!==null&&r!==void 0||(a.firstChildNode=e.firstChild),(n=a.lastChildNode)!==null&&n!==void 0||(a.lastChildNode=e.lastChild),a}var $t={createElement:ir,createElementNS:sr,createTextNode:lr,createDocumentFragment:ar,createComment:cr,insertBefore:dr,removeChild:mr,appendChild:pr,parentNode:Ft,nextSibling:ur,tagName:hr,setTextContent:fr,getTextContent:gr,isElement:br,isText:yr,isComment:vr,isDocumentFragment:j};s();s();function W(e,t,o,r,n){let a=t===void 0?void 0:t.key;return{sel:e,data:t,children:o,text:r,elm:n,key:a}}s();var se=Array.isArray;function J(e){return typeof e=="string"||typeof e=="number"||e instanceof String||e instanceof Number}function tt(e){return e===void 0}function V(e){return e!==void 0}var ot=W("",{},[],void 0,void 0);function ae(e,t){var o,r;let n=e.key===t.key,a=((o=e.data)===null||o===void 0?void 0:o.is)===((r=t.data)===null||r===void 0?void 0:r.is),l=e.sel===t.sel,m=!e.sel&&e.sel===t.sel?typeof e.text==typeof t.text:!0;return l&&n&&a&&m}function xr(){throw new Error("The document fragment is not supported on this platform.")}function kr(e,t){return e.isElement(t)}function Mr(e,t){return e.isDocumentFragment(t)}function Tr(e,t,o){var r;let n={};for(let a=t;a<=o;++a){let l=(r=e[a])===null||r===void 0?void 0:r.key;l!==void 0&&(n[l]=a)}return n}var wr=["create","update","remove","destroy","pre","post"];function le(e,t,o){let r={create:[],update:[],remove:[],destroy:[],pre:[],post:[]},n=t!==void 0?t:$t;for(let c of wr)for(let u of e){let g=u[c];g!==void 0&&r[c].push(g)}function a(c){let u=c.id?"#"+c.id:"",g=c.getAttribute("class"),f=g?"."+g.split(" ").join("."):"";return W(n.tagName(c).toLowerCase()+u+f,{},[],void 0,c)}function l(c){return W(void 0,{},[],void 0,c)}function m(c,u){return function(){if(--u===0){let f=n.parentNode(c);n.removeChild(f,c)}}}function h(c,u){var g,f,x,M;let b,T=c.data;if(T!==void 0){let k=(g=T.hook)===null||g===void 0?void 0:g.init;V(k)&&(k(c),T=c.data)}let v=c.children,C=c.sel;if(C==="!")tt(c.text)&&(c.text=""),c.elm=n.createComment(c.text);else if(C!==void 0){let k=C.indexOf("#"),L=C.indexOf(".",k),A=k>0?k:C.length,E=L>0?L:C.length,H=k!==-1||L!==-1?C.slice(0,Math.min(A,E)):C,R=c.elm=V(T)&&V(b=T.ns)?n.createElementNS(b,H,T):n.createElement(H,T);for(A<E&&R.setAttribute("id",C.slice(A+1,E)),L>0&&R.setAttribute("class",C.slice(E+1).replace(/\./g," ")),b=0;b<r.create.length;++b)r.create[b](ot,c);if(se(v))for(b=0;b<v.length;++b){let Et=v[b];Et!=null&&n.appendChild(R,h(Et,u))}else J(c.text)&&n.appendChild(R,n.createTextNode(c.text));let Te=c.data.hook;V(Te)&&((f=Te.create)===null||f===void 0||f.call(Te,ot,c),Te.insert&&u.push(c))}else if(!((x=o==null?void 0:o.experimental)===null||x===void 0)&&x.fragments&&c.children){for(c.elm=((M=n.createDocumentFragment)!==null&&M!==void 0?M:xr)(),b=0;b<r.create.length;++b)r.create[b](ot,c);for(b=0;b<c.children.length;++b){let k=c.children[b];k!=null&&n.appendChild(c.elm,h(k,u))}}else c.elm=n.createTextNode(c.text);return c.elm}function p(c,u,g,f,x,M){for(;f<=x;++f){let b=g[f];b!=null&&n.insertBefore(c,h(b,M),u)}}function y(c){var u,g;let f=c.data;if(f!==void 0){(g=(u=f==null?void 0:f.hook)===null||u===void 0?void 0:u.destroy)===null||g===void 0||g.call(u,c);for(let x=0;x<r.destroy.length;++x)r.destroy[x](c);if(c.children!==void 0)for(let x=0;x<c.children.length;++x){let M=c.children[x];M!=null&&typeof M!="string"&&y(M)}}}function w(c,u,g,f){for(var x,M;g<=f;++g){let b,T,v=u[g];if(v!=null)if(V(v.sel)){y(v),b=r.remove.length+1,T=m(v.elm,b);for(let k=0;k<r.remove.length;++k)r.remove[k](v,T);let C=(M=(x=v==null?void 0:v.data)===null||x===void 0?void 0:x.hook)===null||M===void 0?void 0:M.remove;V(C)?C(v,T):T()}else v.children?(y(v),w(c,v.children,0,v.children.length-1)):n.removeChild(c,v.elm)}}function S(c,u,g,f){let x=0,M=0,b=u.length-1,T=u[0],v=u[b],C=g.length-1,k=g[0],L=g[C],A,E,H,R;for(;x<=b&&M<=C;)T==null?T=u[++x]:v==null?v=u[--b]:k==null?k=g[++M]:L==null?L=g[--C]:ae(T,k)?(P(T,k,f),T=u[++x],k=g[++M]):ae(v,L)?(P(v,L,f),v=u[--b],L=g[--C]):ae(T,L)?(P(T,L,f),n.insertBefore(c,T.elm,n.nextSibling(v.elm)),T=u[++x],L=g[--C]):ae(v,k)?(P(v,k,f),n.insertBefore(c,v.elm,T.elm),v=u[--b],k=g[++M]):(A===void 0&&(A=Tr(u,x,b)),E=A[k.key],tt(E)?n.insertBefore(c,h(k,f),T.elm):(H=u[E],H.sel!==k.sel?n.insertBefore(c,h(k,f),T.elm):(P(H,k,f),u[E]=void 0,n.insertBefore(c,H.elm,T.elm))),k=g[++M]);M<=C&&(R=g[C+1]==null?null:g[C+1].elm,p(c,R,g,M,C,f)),x<=b&&w(c,u,x,b)}function P(c,u,g){var f,x,M,b,T,v,C,k;let L=(f=u.data)===null||f===void 0?void 0:f.hook;(x=L==null?void 0:L.prepatch)===null||x===void 0||x.call(L,c,u);let A=u.elm=c.elm;if(c===u)return;if(u.data!==void 0||V(u.text)&&u.text!==c.text){(M=u.data)!==null&&M!==void 0||(u.data={}),(b=c.data)!==null&&b!==void 0||(c.data={});for(let R=0;R<r.update.length;++R)r.update[R](c,u);(C=(v=(T=u.data)===null||T===void 0?void 0:T.hook)===null||v===void 0?void 0:v.update)===null||C===void 0||C.call(v,c,u)}let E=c.children,H=u.children;tt(u.text)?V(E)&&V(H)?E!==H&&S(A,E,H,g):V(H)?(V(c.text)&&n.setTextContent(A,""),p(A,null,H,0,H.length-1,g)):V(E)?w(A,E,0,E.length-1):V(c.text)&&n.setTextContent(A,""):c.text!==u.text&&(V(E)&&w(A,E,0,E.length-1),n.setTextContent(A,u.text)),(k=L==null?void 0:L.postpatch)===null||k===void 0||k.call(L,c,u)}return function(u,g){let f,x,M,b=[];for(f=0;f<r.pre.length;++f)r.pre[f]();for(kr(n,u)?u=a(u):Mr(n,u)&&(u=l(u)),ae(u,g)?P(u,g,b):(x=u.elm,M=n.parentNode(x),h(g,b),M!==null&&(n.insertBefore(M,g.elm,n.nextSibling(x)),w(M,[u],0,0))),f=0;f<b.length;++f)b[f].data.hook.insert(b[f]);for(f=0;f<r.post.length;++f)r.post[f]();return g}}s();s();function we(e,t,o){if(e.ns="http://www.w3.org/2000/svg",o!=="foreignObject"&&t!==void 0)for(let r=0;r<t.length;++r){let n=t[r];if(typeof n=="string")continue;let a=n.data;a!==void 0&&we(a,n.children,n.sel)}}function i(e,t,o){let r={},n,a,l;if(o!==void 0?(t!==null&&(r=t),se(o)?n=o:J(o)?a=o.toString():o&&o.sel&&(n=[o])):t!=null&&(se(t)?n=t:J(t)?a=t.toString():t&&t.sel?n=[t]:r=t),n!==void 0)for(l=0;l<n.length;++l)J(n[l])&&(n[l]=W(void 0,void 0,void 0,n[l],void 0));return e[0]==="s"&&e[1]==="v"&&e[2]==="g"&&(e.length===3||e[3]==="."||e[3]==="#")&&we(r,n,e),W(e,r,n,a,void 0)}function Ce(e,t){var o;let r=(o=t.data)===null||o===void 0?void 0:o.ns;e.data.fn=t.data.fn,e.data.args=t.data.args,t.data=e.data,t.children=e.children,t.text=e.text,t.elm=e.elm,r&&we(t.data,t.children,t.sel)}function Cr(e){let t=e.data,o=t.fn(...t.args);Ce(o,e)}function Sr(e,t){let o,r=e.data,n=t.data,a=r.args,l=n.args;if(r.fn!==n.fn||a.length!==l.length){Ce(n.fn(...l),t);return}for(o=0;o<l.length;++o)if(a[o]!==l[o]){Ce(n.fn(...l),t);return}Ce(e,t)}var rt=function(t,o,r,n){return n===void 0&&(n=r,r=o,o=void 0),i(t,{key:o,hook:{init:Cr,prepatch:Sr},fn:r,args:n})};s();var Lr="http://www.w3.org/1999/xlink",Pr="http://www.w3.org/XML/1998/namespace";function Bt(e,t){let o,r=t.elm,n=e.data.attrs,a=t.data.attrs;if(!(!n&&!a)&&n!==a){n=n||{},a=a||{};for(o in a){let l=a[o];n[o]!==l&&(l===!0?r.setAttribute(o,""):l===!1?r.removeAttribute(o):o.charCodeAt(0)!==120?r.setAttribute(o,l):o.charCodeAt(3)===58?r.setAttributeNS(Pr,o,l):o.charCodeAt(5)===58?r.setAttributeNS(Lr,o,l):r.setAttribute(o,l))}for(o in n)o in a||r.removeAttribute(o)}}var ce={create:Bt,update:Bt};s();function Nt(e,t){let o,r,n=t.elm,a=e.data.class,l=t.data.class;if(!(!a&&!l)&&a!==l){a=a||{},l=l||{};for(r in a)a[r]&&!Object.prototype.hasOwnProperty.call(l,r)&&n.classList.remove(r);for(r in l)o=l[r],o!==a[r]&&n.classList[o?"add":"remove"](r)}}var de={create:Nt,update:Nt};s();function Dt(e,t,o){if(typeof e=="function")e.call(t,o,t);else if(typeof e=="object")for(let r=0;r<e.length;r++)Dt(e[r],t,o)}function _r(e,t){let o=e.type,r=t.data.on;r&&r[o]&&Dt(r[o],t,e)}function Er(){return function e(t){_r(t,e.vnode)}}function nt(e,t){let o=e.data.on,r=e.listener,n=e.elm,a=t&&t.data.on,l=t&&t.elm,m;if(o!==a){if(o&&r)if(a)for(m in o)a[m]||n.removeEventListener(m,r,!1);else for(m in o)n.removeEventListener(m,r,!1);if(a){let h=t.listener=e.listener||Er();if(h.vnode=t,o)for(m in a)o[m]||l.addEventListener(m,h,!1);else for(m in a)l.addEventListener(m,h,!1)}}}var it={create:nt,update:nt,destroy:nt};s();s();var Se="\uE00A",Le="\uE00B";var Pe="\uE017";var st="\uE019";var _e="\uE01B",Ee="\uE01C",Ae="\uE01D";var He="\uE01F";var Ie="\uE022";var at="\uE02B",Ot="\uE02C";var Ve="\uE02E";var Fe="\uE031",jt="\uE032",$e="\uE033";var me="\uE03F";var Re="\uE047";var Be="\uE052";var Gt="\uE060";var Ne="\uE06E";s();s();s();s();s();function he(e,t,o=!1){let r,n=0;return function(...a){let l=this;r&&clearTimeout(r),r=void 0;let m=performance.now()-n;n=performance.now(),o&&m>t?e.apply(l,a):r=setTimeout(()=>{r=void 0,e.apply(l,a)},t)}}s();function D(e){return{insert:t=>e(t.elm)}}function _(e,t,o,r=!0){return D(n=>n.addEventListener(e,a=>{let l=t(a);return l===!1&&a.preventDefault(),o==null||o(),l},{passive:r}))}function zt(e){return typeof e=="boolean"?[]:Array.isArray(e)?e.filter(t=>typeof t!="boolean"):[e]}function X(e,t,o){return o?i(e,t,zt(o)):t?Array.isArray(t)||typeof t=="object"&&"sel"in t?i(e,zt(t)):i(e,t):i(e)}s();var Hr=re(()=>{let e=document.createElement("div");e.style.position="absolute",e.style.overflow="scroll",e.style.visibility="hidden",document.body.appendChild(e);let t=e.offsetWidth-e.clientWidth;return document.body.removeChild(e),t});s();s();s();s();s();s();var Ir=[{"stroke-width":3.779,d:"m21.78 12.64c-1.284 8.436 8.943 12.7 14.54 17.61 3 2.632 4.412 4.442 5.684 7.93"},{"stroke-width":4.157,d:"m43.19 36.32c2.817-1.203 6.659-5.482 5.441-7.623-2.251-3.957-8.883-14.69-11.89-19.73-0.4217-0.7079-0.2431-1.835 0.5931-3.3 1.358-2.38 1.956-5.628 1.956-5.628"},{"stroke-width":4.535,d:"m37.45 2.178s-3.946 0.6463-6.237 2.234c-0.5998 0.4156-2.696 0.7984-3.896 0.6388-17.64-2.345-29.61 14.08-25.23 27.34 4.377 13.26 22.54 25.36 39.74 8.666"}],z=(e="-2 -2 54 54")=>i("div.spinner",{"aria-label":"loading"},[i("svg",{attrs:{viewBox:e}},[i("g",{attrs:{mask:"url(#mask)",fill:"none"}},Ir.map(t=>i("path",{attrs:t})))])]);s();var Ys=le([de,ce]);function De(){return lichess.loadEsm("dasher")}s();s();s();var Oe=!1,fe=e=>(Oe===!1&&(Oe=window.Intl&&Intl.NumberFormat?new Intl.NumberFormat:null),Oe===null?""+e:Oe.format(e));s();var Kt={chess960:`This is a Chess960 game!

The starting position of the pieces on the players' home ranks is randomized.`,kingOfTheHill:`This is a King of the Hill game!

The game can be won by bringing the king to the center.`,threeCheck:`This is a Three-check game!

The game can be won by checking the opponent three times.`,antichess:`This is an Antichess game!

If you can take a piece, you must. The game can be won by losing all your pieces, or by being stalemated.`,atomic:`This is an Atomic chess game!

Capturing a piece causes an explosion, taking out your piece and surrounding non-pawns. Win by mating or exploding your opponent's king.`,horde:`This is a Horde chess game!
Black must take all White pawns to win. White must checkmate the Black king.`,racingKings:`This is a Racing Kings game!

Players must race their kings to the eighth rank. Checks are not allowed.`,crazyhouse:`This is a Crazyhouse game!

Every time a piece is captured, the capturing player gets a piece of the same type and of their color in their pocket.`},Ut=e=>"lobby.variant."+e;function lt(e){return!e||Object.keys(Kt).every(function(t){if(e===t&&!lichess.storage.get(Ut(t))){let o=confirm(Kt[t]);return o&&lichess.storage.set(Ut(t),"1"),o}else return!0})}s();function Vr(e,t){return(e.rating||0)>(t.rating||0)?-1:1}function Fr(e,t){return e.t<t.t?-1:1}function ct(e,t){t.sort(e.sort==="time"?Fr:Vr)}function qt(e){e.action=e.sri===lichess.sri?"cancel":"join",e.variant=e.variant||"standard"}function dt(e){e.data.hooks.forEach(qt)}function Jt(e,t){qt(t),e.data.hooks.push(t)}function Xt(e,t){e.data.hooks=t,dt(e)}function Zt(e,t){e.data.hooks=e.data.hooks.filter(o=>o.id!==t),e.stepHooks.forEach(o=>{o.id===t&&(o.disabled=!0)})}function Yt(e,t){e.data.hooks=e.data.hooks.filter(o=>t.includes(o.id))}function Qt(e,t){return e.data.hooks.find(o=>o.id===t)}s();function $r(e,t){return e.rating>t.rating?-1:1}function Rr(e){e.data.seeks.sort($r)}function pt(e){e.data.seeks.forEach(function(t){t.action=e.me&&t.username===e.me.username?"cancelSeek":"joinSeek"}),Rr(e)}function eo(e,t){return e.data.seeks.find(o=>o.id===t)}s();var Nr={key:"lobby.tab",fix(e){return e||"pools"}},Dr={key:"lobby.mode",fix(e){return e||"list"}},Or={key:"lobby.sort",fix(e){return e||"rating"}};function ut(e,t){let o=e.key+":"+(t||"-");return{set(r){let n=e.fix(r);return lichess.storage.set(o,""+n),n},get(){return e.fix(lichess.storage.get(o))}}}function to(e){return{tab:ut(Nr,e),mode:ut(Dr,e),sort:ut(Or,e)}}s();var no=or(ro(),1),ge=(0,no.default)(()=>ne("/lobby/seeks"),2e3),io=()=>ne("/account/now-playing").then(e=>e.nowPlaying),so=e=>ne("/setup/hook/"+lichess.sri,{method:"POST",body:O({variant:1,timeMode:1,time:e.lim,increment:e.inc,days:1,color:"random"})});s();var lo=(e,t)=>`lobby-pool-range.${(e==null?void 0:e.username)||"anon"}.${t}`,co=(e,t)=>{let o=lo(e,t.id);t.range?lichess.storage.set(o,t.range):lichess.storage.remove(o)},mo=(e,t)=>lichess.storage.get(lo(e,t));s();var be=class{constructor(t,o){this.send=t;this.receive=(t,o)=>this.handlers[t]?(this.handlers[t](o),!0):!1;this.handlers={had(r){Jt(o,r),r.action==="cancel"&&o.flushHooks(!0),o.redraw()},hrm(r){r.match(/.{8}/g).forEach(function(n){Zt(o,n)}),o.redraw()},hooks(r){Xt(o,r),o.flushHooks(!0),o.redraw()},hli(r){Yt(o,r.match(/.{8}/g)||[]),o.redraw()},reload_seeks(){o.tab==="seeks"&&ge().then(o.setSeeks)}},lichess.idleTimer(3*60*1e3,()=>t("idle",!0),()=>{t("idle",!1),o.awake()})}realTimeIn(){this.send("hookIn")}realTimeOut(){this.send("hookOut")}poolIn(t){this.send("poolIn",t,{},!0)}poolOut(t){this.send("poolOut",t.id)}};s();s();var po=e=>Array.from(new FormData(e).entries()).filter(([t,o])=>!t.includes("_range")).reduce((t,[o,r])=>({...t,[o]:r}),{}),uo=e=>Object.keys(e).reduce((t,o)=>{let r=o.indexOf("["),n=r>0?o.slice(0,r):o;return r>0?{...t,[n]:[...t[n]||[],e[o]]}:{...t,[n]:e[o]}},{}),ho=e=>({get:()=>JSON.parse(e.get()||"null"),set:t=>e.set(JSON.stringify(t)),remove:()=>e.remove()});var ye=class{constructor(t,o){this.root=o;this.open=!1;this.toggle=()=>{this.open=!this.open};this.set=t=>{this.data=t&&{form:t,filter:uo(t)}};this.save=t=>{let o=t&&po(t);o?this.store.set(o):this.store.remove(),this.set(o),this.root.onSetFilter()};this.filter=t=>{if(!this.data)return{visible:t,hidden:0};let o=this.data.filter,r=o.ratingRange&&o.ratingRange.split("-").map(h=>parseInt(h,10)),n=[],a=[],l,m=0;return t.forEach(h=>{var p,y,w,S;if(l=h.variant,h.action==="cancel")a.push(h);else if(!((p=o.variant)!=null&&p.includes(l))||!((y=o.speed)!=null&&y.includes((h.s||1).toString()))||((w=o.mode)==null?void 0:w.length)==1&&o.mode[0]!=(h.ra||0).toString()||((S=o.increment)==null?void 0:S.length)==1&&o.increment[0]!=h.i.toString()||r&&(!h.rating||h.rating<r[0]||h.rating>r[1]))m++;else{let P=h.ra+l+h.t+h.rating;n.includes(P)||a.push(h),n.push(P)}}),{visible:a,hidden:m}};this.store=ho(t),this.set(this.store.get())}};s();s();var fo=(e,t)=>o=>{if(q(o))return lichess.storage.set(e,JSON.stringify(o)),o;let r=JSON.parse(lichess.storage.get(e));return r!==null?r:t()};s();var K=[{id:1,icon:at,key:"standard",name:"Standard"},{id:10,icon:Le,key:"crazyhouse",name:"Crazyhouse"},{id:2,icon:_e,key:"chess960",name:"Chess960"},{id:4,icon:Ee,key:"kingOfTheHill",name:"King of the Hill"},{id:5,icon:Ie,key:"threeCheck",name:"Three-check"},{id:6,icon:$e,key:"antichess",name:"Antichess"},{id:7,icon:Fe,key:"atomic",name:"Atomic"},{id:8,icon:Be,key:"horde",name:"Horde"},{id:9,icon:Se,key:"racingKings",name:"Racing Kings"},{id:3,icon:at,key:"fromPosition",name:"From Position"}],go=K.filter(({key:e})=>["standard","chess960","kingOfTheHill","threeCheck","fromPosition","antichess","atomic","racingKings","horde"].includes(e)),bo=(e,t)=>t==="hook"?e.filter(({key:o})=>o!=="fromPosition"):e,yo=["antichess","atomic","horde","racingKings","threeCheck"],vo=[{icon:Ne,key:"ultraBullet",name:"UltraBullet"},{icon:Re,key:"bullet",name:"Bullet"},{icon:Ae,key:"blitz",name:"Blitz"},{icon:Pe,key:"rapid",name:"Rapid"},{icon:He,key:"classical",name:"Classical"},{icon:Ve,key:"correspondence",name:"Correspondence"}],Ge=e=>[{id:1,key:"realTime",name:e("realTime")},{id:2,key:"correspondence",name:e("correspondence")},{id:0,key:"unlimited",name:e("unlimited")}],ht=(e,t)=>t.find(o=>o.key===e).id,je=[0,1/4,1/2,3/4,1,3/2,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,25,30,35,40,45,60,75,90,105,120,135,150,165,180],ft=e=>e<je.length?je[e]:180,ve=e=>{if(e<=20)return e;switch(e){case 21:return 25;case 22:return 30;case 23:return 35;case 24:return 40;case 25:return 45;case 26:return 60;case 27:return 90;case 28:return 120;case 29:return 150;default:return 180}},xe=e=>{if(e<=3)return e;switch(e){case 4:return 5;case 5:return 7;case 6:return 10;default:return 14}},We=(e,t,o)=>{for(let r=0;r<o;r++)if(t(r)===e)return r},xo=e=>[{key:"casual",name:e("casual")},{key:"rated",name:e("rated")}],gt=e=>[{key:"black",name:e("black")},{key:"random",name:e("randomColor")},{key:"white",name:e("white")}];var zr=(e,t,o,r)=>{if(!["standard","fromPosition"].includes(e))return e;if(t!=="realTime")return"correspondence";let n=o*60+r*40;return n<30?"ultraBullet":n<180?"bullet":n<480?"blitz":n<1500?"rapid":"classical"},ke=class{constructor(t){this.gameType=null;this.lastValidFen="";this.fenError=!1;this.friendUser="";this.loading=!1;this.time=()=>ft(this.timeV());this.increment=()=>ve(this.incrementV());this.days=()=>xe(this.daysV());this.storeKey=t=>{var o;return`lobby.setup.${((o=this.root.me)==null?void 0:o.username)||"anon"}.${t}`};this.makeSetupStore=t=>fo(this.storeKey(t),()=>({variant:"standard",fen:"",timeMode:t==="hook"?"realTime":"unlimited",time:5,increment:3,days:2,gameMode:t==="ai"||!this.root.me?"casual":"rated",ratingMin:-500,ratingMax:500,aiLevel:1}));this.loadPropsFromStore=t=>{let o=this.store[this.gameType]();this.variant=oe((t==null?void 0:t.variant)||o.variant,this.onDropdownChange),this.fen=this.propWithApply((t==null?void 0:t.fen)||o.fen),this.timeMode=oe((t==null?void 0:t.timeMode)||o.timeMode,this.onDropdownChange),this.timeV=this.propWithApply(We(o.time,ft,100)),this.incrementV=this.propWithApply(We(o.increment,ve,100)),this.daysV=this.propWithApply(We(o.days,xe,20)),this.gameMode=this.propWithApply(o.gameMode),this.ratingMin=this.propWithApply(o.ratingMin),this.ratingMax=this.propWithApply(o.ratingMax),this.aiLevel=this.propWithApply(o.aiLevel),this.enforcePropRules(),this.savePropsToStore()};this.enforcePropRules=()=>{this.variant()==="fromPosition"&&(this.fen=this.propWithApply(this.fen().replace(/_/g," "))),this.gameMode()==="rated"&&this.ratedModeDisabled()&&(this.gameMode=this.propWithApply("casual")),this.ratingMin=this.propWithApply(Math.min(0,this.ratingMin())),this.ratingMax=this.propWithApply(Math.max(0,this.ratingMax())),this.ratingMin()===0&&this.ratingMax()===0&&(this.ratingMax=this.propWithApply(50))};this.savePropsToStore=(t={})=>this.gameType&&this.store[this.gameType]({variant:this.variant(),fen:this.fen(),timeMode:this.timeMode(),time:this.time(),increment:this.increment(),days:this.days(),gameMode:this.gameMode(),ratingMin:this.ratingMin(),ratingMax:this.ratingMax(),aiLevel:this.aiLevel(),...t});this.savePropsToStoreExceptRating=()=>this.gameType&&this.savePropsToStore({ratingMin:this.store[this.gameType]().ratingMin,ratingMax:this.store[this.gameType]().ratingMax});this.isProvisional=()=>{let t=this.root.data.ratingMap&&this.root.data.ratingMap[this.selectedPerf()];return t?!!t.prov:!0};this.onPropChange=()=>{this.isProvisional()?this.savePropsToStoreExceptRating():this.savePropsToStore(),this.root.redraw()};this.onDropdownChange=()=>{this.enforcePropRules(),this.isProvisional()?(this.ratingMin(-500),this.ratingMax(500),this.savePropsToStoreExceptRating()):(this.gameType&&(this.ratingMin(this.store[this.gameType]().ratingMin),this.ratingMax(this.store[this.gameType]().ratingMax)),this.savePropsToStore()),this.root.redraw()};this.propWithApply=t=>oe(t,this.onPropChange);this.openModal=(t,o,r)=>{this.root.leavePool(),this.gameType=t,this.loading=!1,this.fenError=!1,this.lastValidFen="",this.friendUser=r||"",this.loadPropsFromStore(o)};this.closeModal=()=>{this.gameType=null,this.root.redraw()};this.validateFen=he(()=>{let t=this.fen();t&&I(ie("/setup/validate-fen",{fen:t,strict:this.gameType==="ai"?1:void 0})).then(()=>{this.fenError=!1,this.lastValidFen=t,this.root.redraw()},()=>{this.fenError=!0,this.root.redraw()})},300);this.ratedModeDisabled=()=>!this.root.me||this.timeMode()==="unlimited"||this.variant()!=="standard"&&(this.timeMode()!=="realTime"||this.time()<.5&&this.increment()==0||this.time()==0&&this.increment()<2);this.selectedPerf=()=>zr(this.variant(),this.timeMode(),this.time(),this.increment());this.ratingRange=()=>{if(!this.root.data.ratingMap)return"";let t=this.root.data.ratingMap[this.selectedPerf()].rating;return`${Math.max(100,t+this.ratingMin())}-${t+this.ratingMax()}`};this.hookToPoolMember=t=>{let o=t=="random"&&this.gameType==="hook"&&this.variant()=="standard"&&this.gameMode()=="rated"&&this.timeMode()=="realTime",r=`${this.time()}+${this.increment()}`;return o&&this.root.pools.find(n=>n.id===r)?{id:r,range:this.ratingRange()}:null};this.propsToFormData=t=>O({variant:ht(this.variant(),K).toString(),fen:this.fen(),timeMode:ht(this.timeMode(),Ge(this.root.trans)).toString(),time:this.time().toString(),time_range:this.timeV().toString(),increment:this.increment().toString(),increment_range:this.incrementV().toString(),days:this.days().toString(),days_range:this.daysV().toString(),mode:this.gameMode()==="casual"?"0":"1",ratingRange:this.ratingRange(),ratingRange_range_min:this.ratingMin().toString(),ratingRange_range_max:this.ratingMax().toString(),level:this.aiLevel().toString(),color:t});this.validFen=()=>this.variant()!=="fromPosition"||!this.fenError&&!!this.fen();this.validTime=()=>this.timeMode()!=="realTime"||this.time()>0||this.increment()>0;this.validAiTime=()=>this.gameType!=="ai"||this.timeMode()!=="realTime"||this.variant()!=="fromPosition"||this.time()>=1;this.valid=()=>this.validFen()&&this.validTime()&&this.validAiTime();this.submit=async t=>{let o=this.hookToPoolMember(t);if(o){this.root.enterPool(o),this.closeModal();return}this.gameType==="hook"&&this.root.setTab(this.timeMode()==="realTime"?"real_time":"seeks"),this.loading=!0,this.root.redraw();let r=`/setup/${this.gameType}`;this.gameType==="hook"&&(r+=`/${lichess.sri}`);let n={user:this.friendUser||void 0},a;try{a=await et(ie(r,n),{method:"post",body:this.propsToFormData(t)})}catch(p){this.loading=!1,this.root.redraw(),alert("Sorry, we encountered an error while creating your game. Please try again.");return}let{ok:l,redirected:m,url:h}=a;if(l)m?location.href=h:(this.loading=!1,this.closeModal());else{let p=await a.json();alert(p?Object.keys(p).map(y=>`${y}: ${p[y]}`).join(`
`):"Invalid setup"),a.status==403&&this.closeModal()}};this.root=t,this.blindModeColor=oe("random",this.onPropChange),this.store={hook:this.makeSetupStore("hook"),friend:this.makeSetupStore("friend"),ai:this.makeSetupStore("ai")}}};s();s();s();var ko=()=>/Chrome\//.test(navigator.userAgent);var bt=()=>!Ur(),Kr=()=>(navigator==null?void 0:navigator.maxTouchPoints)>2&&/iPad|Macintosh/.test(navigator.userAgent),Da=re(()=>/iPhone|iPod/.test(navigator.userAgent)||Kr()),Ur=re(()=>window.matchMedia("(hover: hover) and (pointer: fine)").matches);var yt;lichess.load.then(async()=>{window.addEventListener("resize",Jr),window.HTMLDialogElement||(yt=(await import(lichess.assetUrl("npm/dialog-polyfill.esm.js"))).default)});async function Mo(e){var t,o,r,n,a;let[l]=await wo(e),m=document.createElement("dialog");for(let[w,S]of Object.entries((o=(t=e.attrs)===null||t===void 0?void 0:t.dialog)!==null&&o!==void 0?o:{}))m.setAttribute(w,String(S));if(bt()&&m.classList.add("touch-scroll"),e.parent&&(m.style.position="absolute"),!e.noCloseButton){let w=$as('<div class="close-button-anchor">');w.innerHTML=`<button class="close-button" aria-label="Close" data-icon="${me}">`,m.appendChild(w)}let h=$as('<div class="dialog-content">');e.class&&h.classList.add(...e.class.split("."));for(let[w,S]of Object.entries((n=(r=e.attrs)===null||r===void 0?void 0:r.view)!==null&&n!==void 0?n:{}))h.setAttribute(w,String(S));l&&(h.innerHTML=l);let p=$as('<div class="scrollable">');p.appendChild(h),m.appendChild(p),((a=e.parent)!==null&&a!==void 0?a:document.body).appendChild(m);let y=new ze(m,h,e);return e.show&&e.show==="modal"?y.showModal():e.show?y.show():y}function To(e){var t,o,r;let n=wo(e),a;return X(`dialog${bt()?".touch-scroll":""}`,{key:(t=e.class)!==null&&t!==void 0?t:"dialog",attrs:(o=e.attrs)===null||o===void 0?void 0:o.dialog,hook:D(l=>a=l)},[e.noCloseButton||X("div.close-button-anchor",X("button.close-button",{attrs:{"data-icon":me,"aria-label":"Close"}})),X("div.scrollable",X("div.dialog-content"+(e.class?`.${e.class}`:""),{attrs:(r=e.attrs)===null||r===void 0?void 0:r.view,hook:D(async l=>{let[m]=await n;m&&!e.vnodes&&(l.innerHTML=m);let h=new ze(a,l,e);e.onInsert?e.onInsert(h):h.showModal()})},e.vnodes))])}var ze=class{constructor(t,o,r){var n,a,l;this.dialog=t,this.view=o,this.o=r,this.show=()=>(this.returnValue="",this.dialog.show(),new Promise(p=>this.resolve=p)),this.showModal=()=>{var p,y;return this.restoreFocus=document.activeElement,(p=$(Co,this.view)[1])===null||p===void 0||p.focus(),this.view.scrollTop=0,(y=this.addModalListeners)===null||y===void 0||y.call(this),this.returnValue="",this.dialog.showModal(),new Promise(w=>{this.resolve=w})},this.close=p=>{this.dialog.close(this.returnValue||p||"ok")},this.onClose=()=>{var p,y,w,S;this.dialog.returnValue||(this.dialog.returnValue="cancel"),"show"in this.o&&this.o.show==="modal"&&(this.dialog.remove(),(p=this.restoreFocus)===null||p===void 0||p.focus()),this.restoreFocus=void 0,(y=this.resolve)===null||y===void 0||y.call(this,this),(S=(w=this.o).onClose)===null||S===void 0||S.call(w,this)},this.addModalListeners=()=>{this.dialog.addEventListener("keydown",qr),this.addModalListeners=void 0},yt&&yt.registerDialog(t);let m=Date.now(),h=()=>Date.now()-m>200&&this.close("cancel");if((n=o.parentElement)===null||n===void 0||n.style.setProperty("--vh",`${window.innerHeight}px`),o.addEventListener("click",p=>p.stopPropagation()),t.addEventListener("cancel",()=>!this.returnValue&&(this.returnValue="cancel")),t.addEventListener("close",this.onClose),(a=t.querySelector(".close-button-anchor > .close-button"))===null||a===void 0||a.addEventListener("click",h),r.noClickAway||setTimeout(()=>t.addEventListener("click",h)),r.action)for(let p of Array.isArray(r.action)?r.action:[r.action])(l=o.querySelector(p.selector))===null||l===void 0||l.addEventListener("click",()=>{!p.action||typeof p.action=="string"?this.close(p.action):p.action(this,p)})}get open(){return this.dialog.open}get returnValue(){return this.dialog.returnValue}set returnValue(t){this.dialog.returnValue=t}};function wo(e){return Promise.all([e.htmlUrl?I(e.htmlUrl):Promise.resolve(e.cash?$as($(e.cash).clone().removeClass("none")).outerHTML:e.htmlText),e.cssPath?lichess.loadCssPath(e.cssPath):Promise.resolve()])}function qr(e){if(e.key==="Tab"){let t=$(Co,e.currentTarget),o=$as(t.first()),r=$as(t.last()),n=document.activeElement;if(n===r&&!e.shiftKey)o.focus();else if(n===o&&e.shiftKey)r.focus();else return;e.preventDefault()}e.stopPropagation()}function Jr(){$("dialog > div.scrollable").css("--vh",`${window.innerHeight}px`)}var Co=["button","input","select","textarea"].map(e=>`${e}:not(:disabled)`).concat(["[href]",'[tabindex="0"]','[role="tab"]']).join(",");function vt(){!document.body.classList.contains("dark-board")||!ko()||!lichess.once("disableDarkBoard")||(De().then(e=>e.subs.background.set("dark")),Mo({htmlText:'<div><h2>Dark board theme disabled</h2><hr><p>Due to a new Chrome bug also affecting Edge, the dark board theme has been temporarily disabled.</p><p>It was causing visual artifacts such as missing pieces.</p><p>You can re-enable the dark board theme from your preference menu if you wish.</p><hr><button class="button dbtd-close" style="padding: 1em 5em">OK</button></div>',show:"modal",action:{selector:"button.dbtd-close"}}))}var Me=class{constructor(t,o){this.opts=t;this.redraw=o;this.stepHooks=[];this.stepping=!1;this.redirecting=!1;this.alreadyWatching=[];this.initNumberSpreader=(t,o,r)=>{let n=r,a=[],l=(m,h,p)=>{t.textContent=fe(Math.round((m*(o-1-p)+h*(p+1))/o))};return m=>{if(!m&&m!==0)return;a.forEach(clearTimeout),a=[];let h=Math.abs(lichess.socket.pingInterval()/o),p=n||m;n=m;for(let y=0;y<o;y++)a.push(setTimeout(()=>l(p,m,y),Math.round(y*h)))}};this.flushHooks=t=>{this.flushHooksTimeout&&clearTimeout(this.flushHooksTimeout),t?this.doFlushHooks():(this.stepping=!0,this.tab==="real_time"&&this.redraw(),setTimeout(()=>{this.stepping=!1,this.doFlushHooks()},500)),this.flushHooksTimeout=this.flushHooksSchedule()};this.flushHooksSchedule=()=>setTimeout(this.flushHooks,8e3);this.setTab=t=>{t!==this.tab&&(t==="seeks"?ge().then(this.setSeeks):t==="real_time"?this.socket.realTimeIn():this.tab==="real_time"&&(this.socket.realTimeOut(),this.data.hooks=[]),this.tab=this.stores.tab.set(t)),this.filter.open=!1};this.setMode=t=>{this.mode=this.stores.mode.set(t),this.filter.open=!1};this.setSort=t=>{this.sort=this.stores.sort.set(t)};this.onSetFilter=()=>{this.flushHooks(!0),this.tab!=="real_time"&&this.redraw()};this.clickHook=t=>{let o=Qt(this,t);!o||o.disabled||this.stepping||this.redirecting||(o.action==="cancel"||lt(o.variant))&&this.socket.send(o.action,o.id)};this.clickSeek=t=>{let o=eo(this,t);!o||this.redirecting||(o.action==="cancelSeek"||lt(o.variant))&&this.socket.send(o.action,o.id)};this.setSeeks=t=>{this.data.seeks=t,pt(this),this.redraw()};this.clickPool=t=>{this.me?this.poolMember&&this.poolMember.id===t?this.leavePool():this.enterPool({id:t}):(so(this.pools.find(o=>o.id==t)),this.setTab("real_time")),this.redraw()};this.enterPool=t=>{co(this.me,t),this.setTab("pools"),this.poolMember=t,this.poolIn()};this.leavePool=()=>{this.poolMember&&(this.socket.poolOut(this.poolMember),this.poolMember=void 0)};this.poolIn=()=>{this.poolMember&&(this.poolInStorage.fire(),this.socket.poolIn(this.poolMember))};this.hasOngoingRealTimeGame=()=>!!this.data.nowPlaying.find(t=>t.isMyTurn&&t.speed!=="correspondence");this.gameActivity=t=>{this.data.nowPlaying.find(o=>o.gameId===t)&&io().then(o=>{this.data.nowPlaying=o,this.startWatching(),this.redraw()})};this.setRedirecting=()=>{this.redirecting=!0,setTimeout(()=>{this.redirecting=!1,this.redraw()},4e3),this.redraw()};this.awake=()=>{switch(this.tab){case"real_time":this.data.hooks=[],this.socket.realTimeIn();break;case"seeks":ge().then(this.setSeeks);break}};this.joinPoolFromLocationHash=()=>{if(location.hash.startsWith("#pool/")){let t=/^#pool\/(\d+\+\d+)(?:\/(.+))?$/,o=t.exec(location.hash),r={id:o[1],blocking:o[2]},n=mo(this.me,r.id);n&&(r.range=n),o&&(this.setTab("pools"),this.me?this.enterPool(r):setTimeout(()=>this.clickPool(r.id),1500),history.replaceState(null,"","/"))}};var n,a;this.data=t.data,this.data.hooks=[],this.me=t.data.me,this.pools=t.pools,this.playban=t.playban,this.filter=new ye(lichess.storage.make("lobby.filter"),this),this.setupCtrl=new ke(this),dt(this),pt(this),this.socket=new be(t.socketSend,this),this.stores=to((n=this.me)==null?void 0:n.username.toLowerCase()),this.tab=(a=this.me)!=null&&a.isBot?"now_playing":this.stores.tab.get(),this.mode=this.stores.mode.get(),this.sort=this.stores.sort.get(),this.trans=t.trans;let r=location.hash.replace("#","");if(["ai","friend","hook"].includes(r)){let l,m={},h=new URLSearchParams(location.search);r==="hook"?h.get("time")==="realTime"?(this.tab="real_time",m.timeMode="realTime"):h.get("time")==="correspondence"&&(this.tab="seeks",m.timeMode="correspondence"):h.get("fen")?(m.fen=h.get("fen"),m.variant="fromPosition"):l=h.get("user"),this.setupCtrl.openModal(r,m,l),history.replaceState(null,"","/")}this.poolInStorage=lichess.storage.make("lobby.pool-in"),this.poolInStorage.listen(l=>{this.leavePool(),o()}),this.flushHooksSchedule(),this.startWatching(),this.playban?this.playban.remainingSeconds<86400&&setTimeout(lichess.reload,this.playban.remainingSeconds*1e3):(setInterval(()=>{this.poolMember?this.poolIn():this.tab==="real_time"&&!this.data.hooks.length&&this.socket.realTimeIn()},10*1e3),this.joinPoolFromLocationHash()),lichess.pubsub.on("socket.open",()=>{this.tab==="real_time"?(this.data.hooks=[],this.socket.realTimeIn()):this.tab==="pools"&&this.poolMember&&this.poolIn(),vt()}),window.addEventListener("beforeunload",()=>this.leavePool())}doFlushHooks(){this.stepHooks=this.data.hooks.slice(0),this.tab==="real_time"&&this.redraw()}startWatching(){let t=this.data.nowPlaying.map(o=>o.gameId).filter(o=>!this.alreadyWatching.includes(o));t.length&&(setTimeout(()=>this.socket.send("startWatching",t.join(" ")),2e3),t.forEach(o=>this.alreadyWatching.push(o)))}};s();s();function Ke(e,t,o,r){return i("span",{attrs:{role:"tab"},class:{active:t===o,glowing:t!==o&&t==="pools"&&!!e.poolMember},hook:_("mousedown",n=>e.setTab(t),e.redraw)},r)}function So(e){var a;let t=e.data.nbNowPlaying,o=e.data.nowPlaying.filter(l=>l.isMyTurn).length,r=e.tab,n=(a=e.me)==null?void 0:a.isBot;return[n?void 0:Ke(e,"pools",r,[e.trans.noarg("quickPairing")]),n?void 0:Ke(e,"real_time",r,[e.trans.noarg("lobby")]),n?void 0:Ke(e,"seeks",r,[e.trans.noarg("correspondence")]),r==="now_playing"||t||n?Ke(e,"now_playing",r,[...e.trans.vdomPlural("nbGamesInPlay",t,t>=100?"100+":t.toString()),o>0?i("i.unread",o>=9?"9+":o):null]):null]}s();function Lo(e){return _("click",t=>{let o=t.target.getAttribute("data-id")||t.target.parentNode.getAttribute("data-id");o==="custom"?e.setupCtrl.openModal("hook"):o&&e.clickPool(o)},e.redraw)}function Po(e){let t=e.poolMember;return e.pools.map(o=>{let r=!!t&&t.id===o.id;return i("div",{class:{active:r,transp:!r&&(!!t&&!r)},attrs:{"data-id":o.id}},[i("div.clock",`${o.lim}+${o.inc}`),r&&t.range&&!e.opts.hideRatings?i("div.range",t.range.replace("-","\u2013")):i("div.perf",o.perf),r?z():null])}).concat(i("div.custom",{class:{transp:!!t},attrs:{"data-id":"custom"}},e.trans.noarg("custom")))}s();s();s();function Ue(e){return e.map(function(t){return i("td",[t])})}var qe={ultraBullet:"UltraBullet",bullet:"Bullet",blitz:"Blitz",rapid:"Rapid",classical:"Classical",correspondence:"Correspondence",racingKings:"Racing Kings",threeCheck:"Three-check",antichess:"Antichess",horde:"Horde",atomic:"Atomic",crazyhouse:"Crazyhouse",chess960:"Chess960",kingOfTheHill:"King of the Hill"};s();var Zr={ultraBullet:Ne,bullet:Re,blitz:Ae,rapid:Pe,classical:He,correspondence:Ve,chess960:_e,kingOfTheHill:Ee,antichess:$e,atomic:Fe,threeCheck:Ie,horde:Be,racingKings:Se,crazyhouse:Le},U=Zr;function Yr(e,t){let o=e.trans.noarg;return i("tr.hook."+t.action,{key:t.id,class:{disabled:!!t.disabled},attrs:{title:t.disabled?"":t.action==="join"?o("joinTheGame")+" | "+qe[t.perf]:o("cancel"),"data-id":t.id}},Ue([i("span.is.color-icon."+(t.c||"random")),t.rating?i("span.ulink.ulpt",{attrs:{"data-href":"/@/"+t.u}},t.u):o("anonymous"),t.rating&&!e.opts.hideRatings?t.rating+(t.prov?"?":""):"",t.clock,i("span",{attrs:{"data-icon":U[t.perf]}},o(t.ra?"rated":"casual"))]))}var _o=e=>t=>t.variant==="standard"===e,Ao=e=>e.action==="cancel",Eo=e=>!Ao(e),Ho=e=>i("i.toggle",{key:"set-mode-chart",attrs:{title:e.trans.noarg("graph"),"data-icon":Ot},hook:_("mousedown",t=>e.setMode("chart"),e.redraw)}),Io=(e,t)=>{let o=t.find(Ao),r=o?13:14,n=t.slice(0,r),a=p=>Yr(e,p),l=n.filter(Eo).filter(_o(!0));ct(e,l);let m=n.filter(Eo).filter(_o(!1)).slice(0,Math.max(0,r-l.length-1));ct(e,m);let h=[...l.map(a),m.length?i("tr.variants",{key:"variants"},[i("td",{attrs:{colspan:5}},"\u2014 "+e.trans("variant")+" \u2014")]):null,...m.map(a)];return o&&h.unshift(a(o)),i("table.hooks__list",[i("thead",i("tr",[i("th"),i("th",e.trans("player")),i("th",{class:{sortable:!0,sort:e.sort==="rating"},hook:_("click",p=>e.setSort("rating"),e.redraw)},[i("i.is"),e.trans("rating")]),i("th",{class:{sortable:!0,sort:e.sort==="time"},hook:_("click",p=>e.setSort("time"),e.redraw)},[i("i.is"),e.trans("time")]),i("th",e.trans("mode"))])),i("tbody",{class:{stepping:e.stepping},hook:_("click",p=>{let y=p.target;do if(y=y.parentNode,y.nodeName==="TR")return e.clickHook(y.getAttribute("data-id"));while(y.nodeName!=="TABLE")},e.redraw)},h)])};s();var Z=e=>e+"%",Je=e=>Math.log(e/150+1);function Vo(e){let t=Math.max(1e3,Math.min(2200,e||1500)),o,r=2/5;return t==1500?o=r:t>1500?o=r+Je(t-1500)/Je(1300)*2*r:o=r-Je(1500-t)/Je(500)*r,Math.round(o*94)}var xt=2e3,Fo=e=>{let t=o=>Math.log((o-30)/200+1);return Math.round(t(Math.min(xt,e||xt))/t(xt)*100)};function en(e,t){let o=Math.max(0,Vo(t.rating)-2),r=Math.max(0,Fo(t.t)-2),n=[t.id,"plot.new",t.ra?"rated":"casual",t.action==="cancel"?"cancel":""].join(".");return i("span#"+n,{key:t.id,attrs:{"data-icon":U[t.perf],style:`bottom:${Z(o)};left:${Z(r)}`},hook:{insert(a){$(a.elm).powerTip({placement:t.rating&&t.rating>1800?"se":"ne",closeDelay:200,popupId:"hook",preRender(){$("#hook").html(tn(e,t)).find(".inner-clickable").on("click",()=>e.clickHook(t.id))}}),setTimeout(function(){a.elm.classList.remove("new")},20)},destroy(a){$.powerTip.hide(a.elm,!0),$.powerTip.destroy(a.elm)}}})}function tn(e,t){let o=t.c||"random",r='<div class="inner">';return t.rating?(r+='<a class="opponent ulpt is color-icon '+o+'" href="/@/'+t.u+'">',r+=" "+t.u,e.opts.hideRatings||(r+=" ("+t.rating+(t.prov?"?":"")+")"),r+="</a>"):r+='<span class="opponent anon '+o+'">'+e.trans("anonymous")+"</span>",r+='<div class="inner-clickable">',r+=`<div>${t.clock}</div>`,r+='<i data-icon="'+U[t.perf]+'"> '+e.trans(t.ra?"rated":"casual")+"</i>",r+="</div></div>",r}var on=[1,2,3,5,7,10,15,20,30];function rn(){let e=[];return on.forEach(t=>{let o=Fo(t*60);e.push(i("span.x.label",{attrs:{style:"left:"+Z(o-1.5)}},""+t)),e.push(i("div.grid.vert",{attrs:{style:"width:"+Z(o)}}))}),e}var nn=[1e3,1200,1400,1500,1600,1800,2e3];function sn(){let e=[];return nn.forEach(function(t){let o=Vo(t);e.push(i("span.y.label",{attrs:{style:"bottom:"+Z(o+1)}},""+t)),e.push(i("div.grid.horiz",{attrs:{style:"height:"+Z(o+.8)}}))}),e}function $o(e){return i("i.toggle",{key:"set-mode-list",attrs:{title:e.trans.noarg("list"),"data-icon":jt},hook:_("mousedown",t=>e.setMode("list"),e.redraw)})}function Ro(e,t){return i("div.hooks__chart",[i("div.canvas",{hook:_("click",o=>{o.target.classList.contains("plot")&&e.clickHook(o.target.id)},e.redraw)},t.map(o=>en(e,o))),...sn(),...rn()])}s();function ln(e,t){var w;let o=(w=e.filter.data)==null?void 0:w.form,r=$(t),n=r.find(".rating-range"),a=n.find('input[name="ratingRange"]'),l=n.find(".rating-range__min"),m=n.find(".rating-range__max");o?Object.keys(o).forEach(S=>{let P=r.find(`input[name="${S}"]`)[0];P&&(P.type=="checkbox"?P.checked=!0:P.value=o[S])}):r.find("input").prop("checked",!0);let h=()=>e.filter.save(r.find("form")[0]);r.find("input").on("change",h),r.find("form").on("reset",S=>{S.preventDefault(),e.filter.save(null),e.filter.open=!1,e.redraw()}).on("submit",S=>{S.preventDefault(),e.filter.open=!1,e.redraw()});function p(S){l.attr("max",m.val()),m.attr("min",l.val());let P=l.val()+"-"+m.val();a.val(P),n.siblings(".range").text(P),S&&h()}let y=a.val()?a.val().split("-"):[];l.attr({step:"50",value:y[0]||l.attr("min")}).on("input",p),m.attr({step:"50",value:y[1]||m.attr("max")}).on("input",p),p()}function Bo(e,t){let o=e.filter;return i("i.toggle.toggle-filter",{class:{gamesFiltered:t>0,active:o.open},hook:_("mousedown",o.toggle,e.redraw),attrs:{"data-icon":o.open?me:st,title:e.trans.noarg("filterGames")}})}var No=e=>i("div.hook__filters",{hook:{insert(t){let o=t.elm;o.filterLoaded||I("/setup/filter").then(r=>{o.innerHTML=r,o.filterLoaded=!0,ln(e,o)})}}});function Do(e){let t,o,r,n,a;switch(e.filter.open&&(t=No(e)),e.mode){case"chart":a=e.filter.filter(e.data.hooks),r=a.hidden,o=t||Ro(e,a.visible),n=e.filter.open?null:$o(e);break;default:a=e.filter.filter(e.stepHooks),r=a.hidden,o=t||Io(e,a.visible),n=e.filter.open?null:Ho(e)}return[Bo(e,r),n,o]}s();function dn(e,t){let o=t.action==="joinSeek"?"join":"cancel",r=e.trans.noarg;return i("tr.seek."+o,{key:t.id,attrs:{title:t.action==="joinSeek"?r("joinTheGame")+" - "+qe[t.perf.key]:r("cancel"),"data-id":t.id}},Ue([i("span.is.color-icon."+(t.color||"random")),t.rating?i("span.ulpt",{attrs:{"data-href":"/@/"+t.username}},t.username):"Anonymous",t.rating&&!e.opts.hideRatings?t.rating+(t.provisional?"?":""):"",t.days?e.trans.pluralSame("nbDays",t.days):"\u221E",i("span",[i("span.varicon",{attrs:{"data-icon":U[t.perf.key]}}),r(t.mode===1?"rated":"casual")])]))}function mn(e){if(e.me&&e.data.seeks.length<8)return i("div.create",[i("a.button",{hook:_("click",()=>e.setupCtrl.openModal("hook",{variant:"standard",timeMode:"correspondence"}),e.redraw)},e.trans("createAGame"))])}function Oo(e){return[i("table.hooks__list",[i("thead",[i("tr",["","player","rating","time","mode"].map(t=>i("th",e.trans(t))))]),i("tbody",{hook:_("click",t=>{let o=t.target;do if(o=o.parentNode,o.nodeName==="TR"){if(!e.me){confirm(e.trans("youNeedAnAccountToDoThat"))&&(location.href="/signup");return}return e.clickSeek(o.getAttribute("data-id"))}while(o.nodeName!=="TABLE")})},e.data.seeks.map(t=>dn(e,t)))]),mn(e)]}s();function pn(e){let t=Date.now()+e.secondsLeft*1e3;return i("time.timeago",{hook:{insert(o){o.elm.setAttribute("datetime",""+t)}}},lichess.timeago(t))}function jo(e){return i("div.now-playing",e.data.nowPlaying.map(t=>i("a."+t.variant.key,{key:`${t.gameId}${t.lastMove}`,attrs:{href:"/"+t.fullId}},[i("span.mini-board.cg-wrap.is2d",{attrs:{"data-state":`${t.fen},${t.orientation||t.color},${t.lastMove}`},hook:{insert(o){lichess.miniBoard.init(o.elm)}}}),i("span.meta",[t.opponent.ai?e.trans("aiNameLevelAiLevel","Stockfish",t.opponent.ai):t.opponent.username,i("span.indicator",t.isMyTurn?t.secondsLeft&&t.hasMoved?pn(t):[e.trans.noarg("yourTurn")]:i("span","\xA0"))])])))}function kt(e){let t,o={};if(e.redirecting)t=z();else switch(e.tab){case"pools":t=Po(e),o={hook:Lo(e)};break;case"real_time":t=Do(e);break;case"seeks":t=Oo(e);break;case"now_playing":t=jo(e);break}return i("div.lobby__app.lobby__app-"+e.tab,[i("div.tabs-horiz",{attrs:{role:"tablist"}},So(e)),i("div.lobby__app__content.l"+(e.redirecting?"redir":e.tab),o,t)])}s();s();s();s();s();var N=({key:e,name:t},o)=>i("option",{attrs:{value:e,selected:e===o}},t);var Y=e=>{let{trans:t,setupCtrl:o}=e,r=lichess.blindMode?go:K;return i("div.variant.label-select",[i("label",{attrs:{for:"sf_variant"}},t("variant")),i("select#sf_variant",{on:{change:n=>o.variant(n.target.value)},hook:D(n=>n.focus())},bo(r,o.gameType).map(n=>N(n,o.variant())))])};s();var Go=e=>e==1/4?"\xBC":e==1/2?"\xBD":e==3/4?"\xBE":e.toString(),un=(e,t)=>{let{trans:o,setupCtrl:r}=e;return[Wo(e,t),r.timeMode()==="realTime"?i("div.time-choice",[i("label",{attrs:{for:"sf_time"}},o("minutesPerSide")),i("select#sf_time",{on:{change:n=>r.timeV(parseFloat(n.target.value))}},je.map((n,a)=>N({key:a.toString(),name:Go(n)},r.timeV().toString())))]):null,r.timeMode()==="realTime"?i("div.increment-choice",[i("label",{attrs:{for:"sf_increment"}},o("incrementInSeconds")),i("select#sf_increment",{on:{change:n=>r.incrementV(parseInt(n.target.value))}},Array.from(Array(31).keys()).map(n=>N({key:n.toString(),name:ve(n).toString()},r.incrementV().toString())))]):null,r.timeMode()==="correspondence"?i("div.days-choice",[i("label",{attrs:{for:"sf_days"}},o("daysPerTurn")),i("select#sf_days",{on:{change:n=>r.daysV(parseInt(n.target.value))}},Array.from(Array(7).keys()).map(n=>N({key:(n+1).toString(),name:xe(n+1).toString()},r.daysV().toString())))]):null]},Wo=(e,t=!1)=>{let{trans:o,setupCtrl:r}=e;return e.me||t?i("div.label-select",[i("label",{attrs:{for:"sf_timeMode"}},o("timeControl")),i("select#sf_timeMode",{on:{change:n=>r.timeMode(n.target.value)}},Ge(o).map(n=>N(n,r.timeMode())))]):null},Mt=(e,t,o,r)=>i("input.range",{class:r,attrs:{type:"range",min:e,max:t,value:o()},on:{input:n=>o(parseFloat(n.target.value))}}),Q=(e,t=!1)=>{let{trans:o,setupCtrl:r}=e;return i("div.time-mode-config.optional-config",lichess.blindMode?un(e,t):[Wo(e,t),r.timeMode()==="realTime"?i("div.time-choice.range",[`${o("minutesPerSide")}: `,i("span",Go(r.time())),Mt(0,38,r.timeV,{failure:!r.validTime()||!r.validAiTime()})]):null,r.timeMode()==="realTime"?i("div.increment-choice.range",[`${o("incrementInSeconds")}: `,i("span",r.increment()),Mt(0,30,r.incrementV,{failure:!r.validTime()})]):r.timeMode()==="correspondence"?i("div.correspondence",i("div.days-choice.range",[`${o("daysPerTurn")}: `,i("span",r.days()),Mt(1,7,r.daysV)])):null])};s();var Xe=e=>{if(!e.me)return null;let{trans:t,setupCtrl:o}=e;return i("div.mode-choice.buttons",i("group.radio",xo(t).map(({key:r,name:n})=>{let a=r==="rated"&&o.ratedModeDisabled();return i("div",[i(`input#sf_mode_${r}.checked_${r===o.gameMode()}`,{attrs:{name:n,type:"radio",value:r,checked:r===o.gameMode(),disabled:a},on:{change:l=>o.gameMode(l.target.value)}}),i("label",{class:{disabled:a},attrs:{for:`sf_mode_${r}`}},n)])})))};s();var zo=e=>{if(!e.me||lichess.blindMode||!e.data.ratingMap)return null;let{trans:t,setupCtrl:o}=e,r=e.setupCtrl.selectedPerf(),n=!!e.data.ratingMap[r].prov,a=n?".disabled":"",l=n?-500:o.ratingMin(),m=n?500:o.ratingMax();return i(`div.rating-range-config.optional-config${a}`,{attrs:n?{title:"Your rating is still provisional, play some rated games to use the rating range."}:void 0},[t("ratingRange"),i("div.rating-range",[i("input.range.rating-range__min",{attrs:{type:"range",min:"-500",max:"0",step:"50",value:l,disabled:n},on:{input:h=>{let p=parseInt(h.target.value);p===0&&o.ratingMax()===0&&o.ratingMax(50),o.ratingMin(p)}}}),i("span.rating-min","-"+Math.abs(l)),"/",i("span.rating-max","+"+m),i("input.range.rating-range__max",{attrs:{type:"range",min:"0",max:"500",step:"50",value:m,disabled:n},on:{input:h=>{let p=parseInt(h.target.value);p===0&&o.ratingMin()===0&&o.ratingMin(-50),o.ratingMax(p)}}})])])};s();var hn=e=>[...e.setupCtrl.gameType==="hook"?[]:[i("label",{attrs:{for:"sf_color"}},e.trans("side")),i("select#sf_color",{on:{change:t=>e.setupCtrl.blindModeColor(t.target.value)}},gt(e.trans).map(t=>N(t,e.setupCtrl.blindModeColor())))],i("button",{on:{click:()=>e.setupCtrl.submit(e.setupCtrl.blindModeColor())}},"Create the game")],ee=e=>{let{setupCtrl:t}=e,o=[];return t.valid()&&(o.push("random"),t.gameType!=="ai"&&t.gameMode()==="rated"&&yo.includes(t.variant())||o.push("white","black")),i("div.color-submits",lichess.blindMode?hn(e):t.loading?z():gt(e.trans).map(({key:r,name:n})=>i(`button.button.button-metal.color-submits__button.${r}`,{attrs:{disabled:!o.includes(r),title:n,value:r},on:{click:()=>e.setupCtrl.submit(r)}},i("i"))))};s();var te=e=>{let{opts:t,data:o}=e;if(lichess.blindMode||!o.ratingMap)return null;let r=e.setupCtrl.selectedPerf(),n=K.find(({key:a})=>a===r)||vo.find(({key:a})=>a===r);if(n){let a={attrs:{"data-icon":n.icon}};return i("div.ratings",t.hideRatings?[i("i",a),n.name]:[...e.trans.vdom("perfRatingX",i("strong",a,o.ratingMap[r].rating+(o.ratingMap[r].prov?"?":""))),n.name])}};function Tt(e){let{trans:t}=e;return[i("h2",t("createAGame")),i("div.setup-content",[Y(e),Q(e),Xe(e),zo(e),ee(e)]),te(e)]}s();s();function wt(e,t,o){let r=o?i("line.line.patron",{attrs:{title:"Lichess Patron"}}):void 0;return i("a",{class:{"user-link":!0,ulpt:!0},attrs:{href:"/@/"+e}},t&&t!="BOT"?[r,i("span.utitle",t),e]:[r,e])}s();var Ze=e=>{let{trans:t,setupCtrl:o}=e;if(o.variant()!=="fromPosition")return null;let r=o.fen();return i("div.fen.optional-config",[i("div.fen__form",[i("input#fen-input",{attrs:{placeholder:t("pasteTheFenStringHere"),value:r},on:{input:n=>{o.fen(n.target.value.trim()),o.validateFen()}},hook:{insert:o.validateFen},class:{failure:o.fenError}}),i("a.button.button-empty",{attrs:{"data-icon":Gt,title:t("boardEditor"),href:"/editor"+(r&&!o.fenError?`/${r.replace(" ","_")}`:"")}})]),i("a.fen__board",{attrs:{href:`/editor/${o.lastValidFen.replace(" ","_")}`}},!o.lastValidFen||!o.validFen()?null:i("span.preview",i("div.position.mini-board.cg-wrap.is2d",{attrs:{"data-state":`${o.lastValidFen},white`},hook:{insert:n=>lichess.miniBoard.init(n.elm),update:n=>lichess.miniBoard.init(n.elm)}})))])};function Ct(e){let{trans:t}=e;return[i("h2",t("playWithAFriend")),i("div.setup-content",[e.setupCtrl.friendUser?wt(e.setupCtrl.friendUser):null,Y(e),Ze(e),Q(e,!0),Xe(e),ee(e)]),te(e)]}s();s();var Ko=e=>{let{trans:t,setupCtrl:o}=e;return lichess.blindMode?[i("label",{attrs:{for:"sf_level"}},t("strength")),i("select#sf_level",{on:{change:r=>o.aiLevel(parseInt(r.target.value))}},"12345678".split("").map(r=>N({key:r,name:r},o.aiLevel().toString())))]:[i("br"),t("strength"),i("div.level.buttons",[i("div.config_level",i("group.radio",[1,2,3,4,5,6,7,8].map(r=>i("div",[i(`input#sf_level_${r}`,{attrs:{name:"level",type:"radio",value:r,checked:r===o.aiLevel()},on:{change:n=>o.aiLevel(parseInt(n.target.value))}}),i("label",{attrs:{for:`sf_level_${r}`}},r)])))),i("div.ai_info",i(`div.sf_level_${o.aiLevel()}`,t("aiNameLevelAiLevel","Fairy-Stockfish 14",o.aiLevel())))])]};function St(e){let{trans:t}=e;return[i("h2",t("playWithTheMachine")),i("div.setup-content",[Y(e),Ze(e),Q(e,!0),...Ko(e),ee(e)]),te(e)]}var fn={hook:Tt,friend:Ct,ai:St};function Lt(e){let{setupCtrl:t}=e;if(!t.gameType)return null;let o=fn[t.gameType];return To({class:"game-setup",cssPath:"lobby.setup",onClose:t.closeModal,vnodes:o(e)})}function Ye(e){var h;let{data:t,trans:o,opts:r}=e,n=e.hasOngoingRealTimeGame(),a=r.playban||r.hasUnreadLichessMessage||((h=e.me)==null?void 0:h.isBot)||n,{members:l,rounds:m}=t.counters;return i("div.lobby__table",[i("div.bg-switch",{attrs:{title:"Dark mode"}},[i("div.bg-switch__track"),i("div.bg-switch__thumb")]),i("div.lobby__start",(lichess.blindMode?[i("h2","Play")]:[]).concat([["hook","createAGame",a],["friend","playWithAFriend",n],["ai","playWithTheMachine",n]].map(([p,y,w])=>i(`button.button.button-metal.config_${p}`,{class:{active:e.setupCtrl.gameType===p,disabled:w},attrs:{type:"button"},hook:w?{}:_(lichess.blindMode?"click":"mousedown",()=>e.setupCtrl.openModal(p),e.redraw)},o(y))))),Lt(e),rt("div.lobby__counters",()=>i("div.lobby__counters",[lichess.blindMode?i("h2","Counters"):null,i("a",{attrs:lichess.blindMode?{}:{href:"/player"}},o.vdomPlural("nbPlayers",l,i("strong",{attrs:{"data-count":l},hook:D(p=>{e.spreadPlayersNumber=e.initNumberSpreader(p,10,l)})},fe(l)))),i("a",lichess.blindMode?{}:{attrs:{href:"/games"}},o.vdomPlural("nbGamesInPlay",m,i("strong",{attrs:{"data-count":m},hook:D(p=>{e.spreadGamesNumber=e.initNumberSpreader(p,8,m)})},fe(m))))]),[])])}var Qe=le([de,ce,it]);function _t(e){let t=new Me(e,n);e.appElement.innerHTML="";let o=Qe(e.appElement,kt(t));e.tableElement.innerHTML="";let r=Qe(e.tableElement,Ye(t));function n(){o=Qe(o,kt(t)),r=Qe(r,Ye(t))}return lichess.requestIdleCallback(()=>{Uo(),window.addEventListener("resize",Uo)}),t}var Pt=0,Uo=()=>requestAnimationFrame(()=>{$("main.lobby").each(function(){let e=Number(window.getComputedStyle(this).getPropertyValue("--cols"));e!=Pt&&(Pt=e,Pt>2?$(".lobby .lobby__timeline").appendTo(".lobby__side"):$(".lobby__side .lobby__timeline").appendTo(".lobby"))})});function Dd(e){e.appElement=document.querySelector(".lobby__app"),e.tableElement=document.querySelector(".lobby__table"),e.pools=[{id:"1+0",lim:1,inc:0,perf:"Bullet"},{id:"2+1",lim:2,inc:1,perf:"Bullet"},{id:"3+0",lim:3,inc:0,perf:"Blitz"},{id:"3+2",lim:3,inc:2,perf:"Blitz"},{id:"5+0",lim:5,inc:0,perf:"Blitz"},{id:"5+3",lim:5,inc:3,perf:"Blitz"},{id:"10+0",lim:10,inc:0,perf:"Rapid"},{id:"10+5",lim:10,inc:5,perf:"Rapid"},{id:"15+10",lim:15,inc:10,perf:"Rapid"},{id:"30+0",lim:30,inc:0,perf:"Classical"},{id:"30+20",lim:30,inc:20,perf:"Classical"}],e.trans=lichess.trans(e.i18n),lichess.socket=new lichess.StrongSocket("/lobby/socket/v5",!1,{receive:(o,r)=>t.socket.receive(o,r),events:{n(o,r){t.spreadPlayersNumber&&t.spreadPlayersNumber(r.d),setTimeout(()=>t.spreadGamesNumber&&t.spreadGamesNumber(r.r),lichess.socket.pingInterval()/2)},reload_timeline(){I("/timeline").then(o=>{$(".timeline").html(o),lichess.contentLoaded()})},featured(o){$(".lobby__tv").html(o.html),lichess.contentLoaded()},redirect(o){return t.leavePool(),t.setRedirecting(),lichess.redirect(o,!0),!0},fen(o){t.gameActivity(o.id)}}}),lichess.StrongSocket.firstConnect.then(()=>{let o=new URLSearchParams(location.search).get("hook_like");if(!o)return;let{ratingMin:r,ratingMax:n}=t.setupCtrl.makeSetupStore("hook")();I(ie(`/setup/hook/${lichess.sri}/like/${o}`,{deltaMin:r,deltaMax:n}),{method:"post"}),t.setTab("real_time"),t.redraw(),history.replaceState(null,"","/")}),e.socketSend=lichess.socket.send;let t=_t(e);e.data.me||gn()}function gn(){let e=window.matchMedia("(prefers-color-scheme: dark)").matches;document.body.getAttribute("data-theme")!=="system"||e||$(".bg-switch").addClass("active").on("click",()=>De().then(o=>o.subs.background.set(document.body.dataset.theme==="dark"?"light":"dark")))}export{Dd as initModule};
